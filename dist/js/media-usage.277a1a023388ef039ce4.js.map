{"version":3,"file":"js/media-usage.277a1a023388ef039ce4.js","mappings":"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","sources":["webpack://@helsingborg-stad/media-usage/./source/js/BulkScan.js","webpack://@helsingborg-stad/media-usage/./source/js/SingleScan.js","webpack://@helsingborg-stad/media-usage/./source/js/media-usage.js","webpack://@helsingborg-stad/media-usage/webpack/bootstrap","webpack://@helsingborg-stad/media-usage/webpack/startup"],"sourcesContent":["//Avoid Wordpress jQuery conflict\nconst $ = jQuery.noConflict();\n\nmodule.exports = class BulkScanner\n{\n    constructor()\n    {\n        if (typeof(bulkScanAjaxObject) != 'undefined') {\n            this.init();\n        }\n    }\n\n    init()\n    {\n        this.queue = bulkScanAjaxObject.attachments;\n        this.attachments = bulkScanAjaxObject.attachments.length;\n\n        this.scanChunkSize = bulkScanAjaxObject.limit;\n        this.isScanning = false;\n\n        this.jsRunScanClickEvent();\n        this.jsStopScanClickEvent();\n    }\n\n    jsRunScanClickEvent()\n    {\n        $(document).on('click', '.js-run-scan', function(e) {\n            e.preventDefault();\n            $(e.target).hide();\n            $('.js-scan-spinner').addClass('is-active');\n            $('.js-stop-scan').show();\n            this.isScanning = true;\n            this.runMediaScanner();\n        }.bind(this));\n    }\n\n    jsStopScanClickEvent()\n    {\n        $(document).on('click', '.js-stop-scan', function(e) {\n            e.preventDefault();\n            this.isScanning = false;\n            $(e.target).hide();\n            $('.js-scan-spinner').removeClass('is-active');\n            $('.js-run-scan').show();\n        }.bind(this));\n    }\n\n    runMediaScanner()\n    {\n        if (this.queue.length === 0 || this.isScanning === false) {\n            var spinner = $('.js-scan-spinner');\n            if (spinner.hasClass('is-active')) {\n                spinner.removeClass('is-active');\n                $('.js-stop-scan').hide();\n                $('.js-run-scan').show();\n            }\n\n            return;\n        }\n\n        var attachmentsIdsToScan = this.queue.splice(0, this.scanChunkSize);\n\n        $.ajax({\n            url : bulkScanAjaxObject.ajaxUrl,\n            type : 'post',\n            data : {\n                action : 'scanUsageAjaxMethod',\n                nonce : bulkScanAjaxObject.nonce,\n                attachments: attachmentsIdsToScan,\n                queue: this.queue.length\n            },\n            success : function(response, status) {\n                this.updateProgress();\n                this.runMediaScanner();\n            }.bind(this),\n            error : function(jqXHR, status, error) {\n            }\n        });\n    }\n\n    updateProgress()\n    {\n        //Update scanned count\n        if ($('.js-scanned').length > 0) {\n            $('.js-scanned').text(this.attachments - this.queue.length);\n        }\n\n        //Update Precentage\n        if ($('.js-progress').length > 0 && $('.js-progress').text() != this.getScanProgressInPrecentage()) {\n            $('.js-progress').text(this.getScanProgressInPrecentage());\n        }\n    }\n\n    getScanProgressInPrecentage()\n    {\n        return  Math.round((((this.attachments - this.queue.length) / this.attachments) * 100));\n    }\n}\n","//Avoid Wordpress jQuery conflict\nconst $ = jQuery.noConflict();\n\nmodule.exports = class Scanner\n{\n    constructor()\n    {\n        if (typeof(singleScanAjaxObject) != 'undefined') {\n            this.jsRefreshUsage();\n        }\n    }\n\n    jsRefreshUsage()\n    {\n        $(document).on('click', '.js-refresh-usage', function(e) {\n            e.preventDefault();\n            $('#attachment_usage').addClass('is-disabled');\n            this.runMediaScanner();\n        }.bind(this));\n    }\n\n    runMediaScanner()\n    {\n        $.ajax({\n            url : singleScanAjaxObject.ajaxUrl,\n            type : 'post',\n            data : {\n                action : 'scanUsageAjaxMethod',\n                nonce : singleScanAjaxObject.nonce,\n                attachments: [singleScanAjaxObject.attachment]\n            },\n            success : function(response, status) {\n                this.reRenderUsage();\n            }.bind(this),\n        });\n    }\n\n    reRenderUsage()\n    {\n        $.ajax({\n            url : singleScanAjaxObject.ajaxUrl,\n            type : 'post',\n            data : {\n                action : 'outputUsageListAjaxMethod',\n                nonce : singleScanAjaxObject.nonce,\n                attachment: singleScanAjaxObject.attachment\n            },\n            success : function(response, status) {\n                $('#attachment_usage').removeClass('is-disabled');\n                $('.js-media-usage-wrapper').html(response);\n            }.bind(this),\n        });\n    }\n}\n","'use strict';\nconst $ = jQuery.noConflict();\nconst BulkScan = require('./BulkScan.js');\nconst SingleScan = require('./SingleScan.js');\n\n\nclass MediaUsage {\n\n    constructor() {\n        if (typeof(getPostType) != 'undefined') {\n            this.jsRefreshUsage();\n        }\n        // Warn user when deleting media in library\n        this.warning();\n        this.deleteLink();\n        // Scan media\n        new BulkScan();\n        new SingleScan();\n    }\n\n    deleteLink() {\n\n        $(window).load(function () {\n\n            let skipNextStep = false;\n\n            $(document).on('click', '.attachment-preview', function (e) {\n\n                let url = $('.media-modal-content').find('.setting .name').next('span').find('a').prop('href');\n                let title = $('.media-modal-content').find('.setting .name').next('span').find('a').text();\n                let removalID = $('.media-modal-content .attachment-details').attr('data-id');\n                let removeUrl = 'post.php?action=delete&post='+removalID+'&_wpnonce='+hbgmedia.rmNonce;\n\n                if (title) {\n\n                    let imgUrl;\n\n                    $('.media-modal-content .filename').each(function( index ) {\n                        if(index == 0) {\n                            $(this).find('strong').remove();\n                            imgUrl = $(this).text().trim();\n                        }\n                    });\n\n                    $('.media-modal-content .actions .delete-attachment').remove();\n                    $('.media-modal-content .actions').append('<a data-imgname=\"'+imgUrl+'\"  data-url=\"' + url + '\"  onclick=\"return false;\" href=\"'+removeUrl+'\" class=\"checkDependencies\">' + hbgmedia.deleteBtn + '</a>');\n                }\n                skipNextStep = true;\n            });\n\n            if (!skipNextStep) {\n\n                $('.row-actions').each(function () {\n\n                    let strong = $(this).closest('tr').find('.parent.column-parent').find('strong');\n\n                    if (strong.length > 0) {\n                        $(this).closest('tr').find('.filename span').remove();\n\n                        let url = $(this).closest('tr').find('.parent.column-parent a').prop('href');\n                        let imgUrl = $(this).closest('tr').find('.filename').text().trim();\n                        let removeUrl = $(this).find('.delete a').attr('href');\n\n                        $(this).find('.delete').addClass('hidden');\n                        $(this).find('.edit').after('<span class=\"content-attached\"><a data-imgname=\"'+imgUrl+'\" data-url=\"' + url + '\"  onclick=\"return false;\" class=\"checkDependencies aria-button-if-js\" href=\"'+removeUrl+'\">' + hbgmedia.deleteBtn + '</a></span>  | ');\n                    }\n                });\n            }\n        });\n    }\n\n    warning() {\n\n        $(document).on('click', '.checkDependencies', function (e) {\n\n            let reg = new RegExp('[?&]' + 'post' + '=([^&#]*)', 'i');\n            let stringHref = reg.exec($(this).attr('data-url'));\n            let imgName = $(this).attr('data-imgname');\n\n            if (stringHref) {\n                let data = {\n                    'action': 'getMediaPostTitle',\n                    'nonce': hbgmedia.nonce,\n                    'id': stringHref[1]\n                };\n\n                jQuery.post(hbgmedia.url, data, function (response) {\n\n                    let confirDelete;\n                    if (response) {\n                        confirDelete = confirm(hbgmedia.response + ': ' + response);\n                    }\n\n                    if(confirDelete) {\n                        let Removedata = {\n                            'action': 'deleteAttachment',\n                            'nonce': hbgmedia.nonce,\n                            'id': stringHref[1],\n                            'post_type': 'attachment',\n                            'imgName' : imgName.trim()\n                        };\n                        jQuery.post(hbgmedia.url, Removedata, function (resp) {\n                            location.href = 'upload.php';\n                        });\n                    }\n                });\n            }\n\n        });\n    }\n}\n\nnew MediaUsage();\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// startup\n// Load entry module and return exports\n__webpack_require__(49);\n// This entry module is referenced by other modules so it can't be inlined\n__webpack_require__(858);\nvar __webpack_exports__ = __webpack_require__(386);\n"],"names":["$","jQuery","noConflict","module","exports","constructor","this","init","queue","bulkScanAjaxObject","attachments","length","scanChunkSize","limit","isScanning","jsRunScanClickEvent","jsStopScanClickEvent","document","on","e","preventDefault","target","hide","addClass","show","runMediaScanner","bind","removeClass","attachmentsIdsToScan","splice","ajax","url","ajaxUrl","type","data","action","nonce","success","response","status","updateProgress","error","jqXHR","spinner","hasClass","text","getScanProgressInPrecentage","Math","round","jsRefreshUsage","singleScanAjaxObject","attachment","reRenderUsage","html","BulkScan","SingleScan","warning","deleteLink","window","load","skipNextStep","find","next","prop","title","removeUrl","attr","hbgmedia","rmNonce","imgUrl","each","index","remove","trim","append","deleteBtn","closest","after","stringHref","RegExp","exec","imgName","post","confirDelete","confirm","Removedata","resp","location","href","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","__webpack_modules__"],"sourceRoot":""}