{"version":3,"file":"js/media-usage.c8926fc9dce8aa1b772e.js","mappings":"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","sources":["webpack://@helsingborg-stad/media-usage/./source/js/media-usage.js","webpack://@helsingborg-stad/media-usage/./source/js/SingleScan.js","webpack://@helsingborg-stad/media-usage/./source/js/BulkScan.js","webpack://@helsingborg-stad/media-usage/webpack/bootstrap","webpack://@helsingborg-stad/media-usage/webpack/startup"],"sourcesContent":["'use strict';\nconst $ = jQuery.noConflict();\nconst BulkScan = require('./BulkScan.js');\nconst SingleScan = require('./SingleScan.js');\n\n\nclass MediaUsage {\n\n    constructor() {\n        if (typeof(getPostType) != 'undefined') {\n            this.jsRefreshUsage();\n        }\n        // Warn user when deleting media in library\n        this.warning();\n        this.deleteLink();\n        // Scan media\n        new BulkScan();\n        new SingleScan();\n    }\n\n    deleteLink() {\n\n        $(window).load(function () {\n\n            let skipNextStep = false;\n\n            $(document).on('click', '.attachment-preview', function (e) {\n\n                let url = $('.media-modal-content').find('.setting .name').next('span').find('a').prop('href');\n                let title = $('.media-modal-content').find('.setting .name').next('span').find('a').text();\n                let removalID = $('.media-modal-content .attachment-details').attr('data-id');\n                let removeUrl = 'post.php?action=delete&post='+removalID+'&_wpnonce='+hbgmedia.rmNonce;\n\n                if (title) {\n\n                    let imgUrl;\n\n                    $('.media-modal-content .filename').each(function( index ) {\n                        if(index == 0) {\n                            $(this).find('strong').remove();\n                            imgUrl = $(this).text().trim();\n                        }\n                    });\n\n                    $('.media-modal-content .actions .delete-attachment').remove();\n                    $('.media-modal-content .actions').append('<a data-imgname=\"'+imgUrl+'\"  data-url=\"' + url + '\"  onclick=\"return false;\" href=\"'+removeUrl+'\" class=\"checkDependencies\">' + hbgmedia.deleteBtn + '</a>');\n                }\n                skipNextStep = true;\n            });\n\n            if (!skipNextStep) {\n\n                $('.row-actions').each(function () {\n\n                    let strong = $(this).closest('tr').find('.parent.column-parent').find('strong');\n\n                    if (strong.length > 0) {\n                        $(this).closest('tr').find('.filename span').remove();\n\n                        let url = $(this).closest('tr').find('.parent.column-parent a').prop('href');\n                        let imgUrl = $(this).closest('tr').find('.filename').text().trim();\n                        let removeUrl = $(this).find('.delete a').attr('href');\n\n                        $(this).find('.delete').addClass('hidden');\n                        $(this).find('.edit').after('<span class=\"content-attached\"><a data-imgname=\"'+imgUrl+'\" data-url=\"' + url + '\"  onclick=\"return false;\" class=\"checkDependencies aria-button-if-js\" href=\"'+removeUrl+'\">' + hbgmedia.deleteBtn + '</a></span>  | ');\n                    }\n                });\n            }\n        });\n    }\n\n    warning() {\n\n        $(document).on('click', '.checkDependencies', function (e) {\n\n            let reg = new RegExp('[?&]' + 'post' + '=([^&#]*)', 'i');\n            let stringHref = reg.exec($(this).attr('data-url'));\n            let imgName = $(this).attr('data-imgname');\n\n            if (stringHref) {\n                let data = {\n                    'action': 'getMediaPostTitle',\n                    'nonce': hbgmedia.nonce,\n                    'id': stringHref[1]\n                };\n\n                jQuery.post(hbgmedia.url, data, function (response) {\n\n                    let confirDelete;\n                    if (response) {\n                        confirDelete = confirm(hbgmedia.response + ': ' + response);\n                    }\n\n                    if(confirDelete) {\n                        let Removedata = {\n                            'action': 'deleteAttachment',\n                            'nonce': hbgmedia.nonce,\n                            'id': stringHref[1],\n                            'post_type': 'attachment',\n                            'imgName' : imgName.trim()\n                        };\n                        jQuery.post(hbgmedia.url, Removedata, function (resp) {\n                            location.href = 'upload.php';\n                        });\n                    }\n                });\n            }\n\n        });\n    }\n}\n\nnew MediaUsage();\n","//Avoid Wordpress jQuery conflict\nconst $ = jQuery.noConflict();\n\nmodule.exports = class Scanner\n{\n    constructor()\n    {\n        if (typeof(singleScanAjaxObject) != 'undefined') {\n            this.jsRefreshUsage();\n        }\n    }\n\n    jsRefreshUsage()\n    {\n        $(document).on('click', '.js-refresh-usage', function(e) {\n            e.preventDefault();\n            $('#attachment_usage').addClass('is-disabled');\n            this.runMediaScanner();\n        }.bind(this));\n    }\n\n    runMediaScanner()\n    {\n        $.ajax({\n            url : singleScanAjaxObject.ajaxUrl,\n            type : 'post',\n            data : {\n                action : 'scanUsageAjaxMethod',\n                nonce : singleScanAjaxObject.nonce,\n                attachments: [singleScanAjaxObject.attachment]\n            },\n            success : function(response, status) {\n                this.reRenderUsage();\n            }.bind(this),\n        });\n    }\n\n    reRenderUsage()\n    {\n        $.ajax({\n            url : singleScanAjaxObject.ajaxUrl,\n            type : 'post',\n            data : {\n                action : 'outputUsageListAjaxMethod',\n                nonce : singleScanAjaxObject.nonce,\n                attachment: singleScanAjaxObject.attachment\n            },\n            success : function(response, status) {\n                $('#attachment_usage').removeClass('is-disabled');\n                $('.js-media-usage-wrapper').html(response);\n            }.bind(this),\n        });\n    }\n}\n","//Avoid Wordpress jQuery conflict\nconst $ = jQuery.noConflict();\n\nmodule.exports = class BulkScanner\n{\n    constructor()\n    {\n        if (typeof(bulkScanAjaxObject) != 'undefined') {\n            this.init();\n        }\n    }\n\n    init()\n    {\n        this.queue = bulkScanAjaxObject.attachments;\n        this.attachments = bulkScanAjaxObject.attachments.length;\n\n        this.scanChunkSize = bulkScanAjaxObject.limit;\n        this.isScanning = false;\n\n        this.jsRunScanClickEvent();\n        this.jsStopScanClickEvent();\n    }\n\n    jsRunScanClickEvent()\n    {\n        $(document).on('click', '.js-run-scan', function(e) {\n            e.preventDefault();\n            $(e.target).hide();\n            $('.js-scan-spinner').addClass('is-active');\n            $('.js-stop-scan').show();\n            this.isScanning = true;\n            this.runMediaScanner();\n        }.bind(this));\n    }\n\n    jsStopScanClickEvent()\n    {\n        $(document).on('click', '.js-stop-scan', function(e) {\n            e.preventDefault();\n            this.isScanning = false;\n            $(e.target).hide();\n            $('.js-scan-spinner').removeClass('is-active');\n            $('.js-run-scan').show();\n        }.bind(this));\n    }\n\n    runMediaScanner()\n    {\n        if (this.queue.length === 0 || this.isScanning === false) {\n            var spinner = $('.js-scan-spinner');\n            if (spinner.hasClass('is-active')) {\n                spinner.removeClass('is-active');\n                $('.js-stop-scan').hide();\n                $('.js-run-scan').show();\n            }\n\n            return;\n        }\n\n        var attachmentsIdsToScan = this.queue.splice(0, this.scanChunkSize);\n\n        $.ajax({\n            url : bulkScanAjaxObject.ajaxUrl,\n            type : 'post',\n            data : {\n                action : 'scanUsageAjaxMethod',\n                nonce : bulkScanAjaxObject.nonce,\n                attachments: attachmentsIdsToScan,\n                queue: this.queue.length\n            },\n            success : function(response, status) {\n                this.updateProgress();\n                this.runMediaScanner();\n            }.bind(this),\n            error : function(jqXHR, status, error) {\n            }\n        });\n    }\n\n    updateProgress()\n    {\n        //Update scanned count\n        if ($('.js-scanned').length > 0) {\n            $('.js-scanned').text(this.attachments - this.queue.length);\n        }\n\n        //Update Precentage\n        if ($('.js-progress').length > 0 && $('.js-progress').text() != this.getScanProgressInPrecentage()) {\n            $('.js-progress').text(this.getScanProgressInPrecentage());\n        }\n    }\n\n    getScanProgressInPrecentage()\n    {\n        return  Math.round((((this.attachments - this.queue.length) / this.attachments) * 100));\n    }\n}\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// startup\n// Load entry module and return exports\n__webpack_require__(49);\n// This entry module is referenced by other modules so it can't be inlined\n__webpack_require__(858);\nvar __webpack_exports__ = __webpack_require__(386);\n"],"names":["$","jQuery","noConflict","BulkScan","SingleScan","constructor","this","jsRefreshUsage","warning","deleteLink","window","load","skipNextStep","document","on","e","url","find","next","prop","title","text","removeUrl","attr","hbgmedia","rmNonce","imgUrl","each","index","remove","trim","append","deleteBtn","closest","length","addClass","after","stringHref","RegExp","exec","imgName","data","nonce","post","response","confirDelete","confirm","Removedata","resp","location","href","module","exports","preventDefault","runMediaScanner","bind","ajax","singleScanAjaxObject","ajaxUrl","type","action","attachments","attachment","success","status","reRenderUsage","removeClass","html","init","queue","bulkScanAjaxObject","scanChunkSize","limit","isScanning","jsRunScanClickEvent","jsStopScanClickEvent","target","hide","show","attachmentsIdsToScan","splice","updateProgress","error","jqXHR","spinner","hasClass","getScanProgressInPrecentage","Math","round","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","__webpack_modules__"],"ignoreList":[],"sourceRoot":""}